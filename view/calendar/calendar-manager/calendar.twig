{% do headTitle().append(translate("txt-admin")) %}
{% do headTitle().append(translate("txt-calendar-item-%s")|format(calendarService.calendar)) %}

<h1>{{ translate("txt-calendar-item-%s")|format(calendarService.calendar) }}</h1>

<!-- Nav tabs -->
<ul class="nav nav-tabs">
    <li class="active"><a href="#general" data-toggle="tab">{{ translate("txt-general-information") }}</a></li>
    <li><a href="#document" data-toggle="tab">{{ translate("txt-documents") }}</a></li>
    <li><a href="#attendee" data-toggle="tab">{{ translate("txt-attendees") }}</a></li>
    {#<li><a href="#schedule" data-toggle="tab">{{ translate("txt-effort") }}</a></li>#}
</ul>

<!-- Tab panes -->
<div class="tab-content">
    <div class="tab-pane active" id="general">
        <h3>{{ translate("txt-calendar-details") }}</h3>

        <dl class="dl-horizontal">
            <dt>{{ translate("txt-calendar-name") }}</dt>
            <dd>{{ calendarLink(calendarService.calendar,'view-community', 'name') }}</dd>
            <dt>{{ translate("txt-date") }}</dt>
            <dd>{{ calendarService.calendar.dateFrom|from_to_date(calendarService.calendar.dateEnd) }}</dd>
            <dt>{{ translate("txt-date-from") }}</dt>
            <dd>{{ calendarService.calendar.dateFrom|date }}</dd>
            <dt>{{ translate("txt-date-end") }}</dt>
            <dd>{{ calendarService.calendar.dateEnd|date }}</dd>
            <dt>{{ translate("txt-calendar-type") }}</dt>
            <dd>{{ calendarService.calendar.type }}</dd>
            {% if calendarService.calendar.projectCalendar %}
                {% set projectService = projectServiceProxy(calendarService.calendar.projectCalendar.project) %}
                <dt>{{ translate("txt-project-name") }}</dt>
                <dd>{{ projectLink(projectService,'view-admin','name') }} {{ projectLink(projectService,'view-community','icon') }}</dd>
            {% endif %}
            <dt>{{ translate("txt-location") }}</dt>
            <dd>{{ calendarService.calendar.location }}</dd>
            <dt>{{ translate("txt-docref") }}</dt>
            <dd>{{ calendarService.calendar.docRef }}</dd>
            <dt>{{ translate("txt-state") }}</dt>
            <dd>{{ translate(calendarService.calendar.getFinal(true)) }}</dd>
            <dt>{{ translate("txt-on-homepage") }}</dt>
            <dd>{{ translate(calendarService.calendar.getOnHomepage(true)) }}
                ({{ translate("txt-sequence:-%s")|format(calendarService.calendar.sequence) }})
            </dd>
            {% if calendarService.calendar.description %}
                <dt>{{ translate("txt-description") }}</dt>
                <dd>{{ calendarService.calendar.description|raw }}</dd>
            {% endif %}
            {% if calendarService.calendar.imageUrl %}
                <dt>{{ translate("txt-image-url") }}</dt>
                <dd>{{ calendarService.calendar.imageUrl }}</dd>
            {% endif %}
            {% if calendarService.calendar.url %}
                <dt>{{ translate("txt-url") }}</dt>
                <dd><a href="{{ calendarService.calendar.url }}">{{ calendarService.calendar.url }}</a></dd>
            {% endif %}
            {% if calendarService.calendar.dateCreated %}
                <dt>{{ translate("txt-date-created") }}</dt>
                <dd>{{ calendarService.calendar.dateCreated|string_date }}
                    {{ translate("txt-by-%s")|format(calendarService.calendar.contact.displayName()) }}</dd>
            {% endif %}
            {% if calendarService.calendar.lastUpdate %}
                <dt>{{ translate("txt-last-update") }}</dt>
                <dd>{{ calendarService.lastUpdate|string_date }}</dd>
            {% endif %}
            <dt>{{ translate("txt-access") }}</dt>
            {% for access in calendarService.calendar.type.access %}
                <dd><code>{{ access }}</code></dd>
            {% endfor %}
        </dl>

        {{ calendarLink(calendarService.calendar,'edit', 'button') }}

    </div>
    <div class="tab-pane" id="document">

        <h2>{{ translate("txt-calendar-documents") }}</h2>
        {% if calendarService.calendar.document.count() > 0 %}

            <table class="table table table-hover table-striped">
                <thead>
                <tr>
                    <th>{{ translate("txt-document") }}</th>
                    <th>{{ translate("txt-type") }}</th>
                    <th>{{ translate("txt-date") }}</th>
                    <th>{{ translate("txt-size") }}</th>
                </tr>
                </thead>
                <tbody>
                {% for document in calendarService.calendar.document %}
                    <tr>
                        <td>{{ calendarDocumentLink(document,'document-admin','name') }}
                            {{ calendarDocumentLink(document,'download','icon') }}
                        </td>
                        <td>{{ contentTypeIcon(document.contentType) }} {{ document.contentType }}</td>
                        <td>{{ document.dateCreated|string_date }}</td>
                        <td>{{ document.size|parse_size }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            {{ ztbalert().info(translate("txt-no-documents-uploaded-for-this-calendar-%s")|
            format(calendarService.calendar))|raw }}
        {% endif %}

        <h4>{{ translate("txt-upload-new-calendar-documents") }}</h4>

        {% do form.prepare() %}
        {{ form().openTag(form)|raw }}

        {{ ztbformelement(form.get('document')) }}
        {{ ztbformelement(form.get('file')) }}

        <div class="form-group">
            <div class="col-sm-offset-3 col-sm-9">
                {{ ztbformelement(form.get('submit')) }}
            </div>
        </div>

        {{ form().closeTag()|raw }}

    </div>
    <div class="tab-pane" id="attendee">

        <h2>{{ translate("txt-calendar-attendees") }}</h2>
        {% if calendarService.calendar.calendarContact.count() > 0 %}
            <table class="table table-hover table-striped">
                <thead>
                <tr>
                    <th>{{ translate("txt-name") }}</th>
                    <th>{{ translate("txt-organisation") }}</th>
                    <th>{{ translate("txt-role") }}</th>
                    <th>{{ translate("txt-presence") }}</th>
                </tr>
                </thead>
                <tbody>
                {% for calendarContact in calendarService.calendar.calendarContact %}
                    {% set contactService = contactServiceProxy(calendarContact.contact) %}
                    <tr {% if zfcUserIdentity().getId() == contactService.contact.id %}class="success"{% endif %}>
                        <td>
                            {% if zfcUserIdentity().getId() == contactService.contact.id %}
                                <i class="fa fa-user"></i>
                            {% endif %}
                            {{ calendarContact.contact.displayName }}
                            <div class="pull-right"><a href="mailto:{{ calendarContact.contact.email }}"><i
                                            class="fa fa-envelope-o"></i></a> {{ contactLink(calendarContact.contact,'view-admin','icon') }}
                            </div>
                        </td>
                        <td>{{ contactService.parseOrganisation() }} ({{ contactService.parseCountry() }})</td>

                        <td>


                            <a id="calendarcontact_{{ calendarContact.id }}"
                               href="#" class="role"
                               data-type="select"
                               data-source="{{ url('zfcadmin/calendar-manager/get-roles') }}"
                               data-pk="{{ calendarContact.id }}"
                               data-value="{{ calendarContact.role.id }}"
                               data-url="{{ url('zfcadmin/calendar-manager/update-role') }}"
                               data-title="{{ translate("txt-update-role") }}">{{ calendarContact.role }}</a>
                        </td>
                        <td>
                            {% do calendarService.addResource(calendarContact,'Calendar\Acl\Assertion\Contact') %}
                            {% if isAllowed(calendarContact,'update-status') %}
                            <i title="{{ translate("txt-presence-status-tentative-hover-text") }}"
                               rel="{{ calendarContact.id }}-{{ constant("Calendar\\Entity\\ContactStatus::STATUS_TENTATIVE") }}"
                               class="presence-icon fa fa-question-circle {% if calendarContact.status.id == constant("Calendar\\Entity\\ContactStatus::STATUS_TENTATIVE") %}active{% endif %}"></i>
                            <i title="{{ translate("txt-presence-status-decline-hover-text") }}"
                               rel="{{ calendarContact.id }}-{{ constant("Calendar\\Entity\\ContactStatus::STATUS_DECLINE") }}"
                               class="presence-icon fa fa-ban {% if calendarContact.status.id == constant("Calendar\\Entity\\ContactStatus::STATUS_DECLINE") %}active{% endif %}"></i>
                            <i title="{{ translate("txt-presence-status-accept-hover-text") }}"
                               rel="{{ calendarContact.id }}-{{ constant("Calendar\\Entity\\ContactStatus::STATUS_ACCEPT") }}"
                               class="presence-icon fa fa-check-square-o {% if calendarContact.status.id == constant("Calendar\\Entity\\ContactStatus::STATUS_ACCEPT") %}active{% endif %}"></i>
                            {% else %}
                            {{ calendarContact.status }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            {{ ztbalert().info(translate("txt-no-attandeed-defined-for-this-calendar-%s")|
            format(calendarService.calendar))|raw }}
        {% endif %}


        {{ calendarLink(calenderService.calendar,'edit-attendees-admin','button') }}
        {{ calendarLink(calenderService.calendar,'presence-list','button') }}
        {{ calendarLink(calenderService.calendar,'select-attendees','button') }}
    </div>
</div>


<script type="text/javascript">
    /**
     * Calculate the sum per year
     */
    $(document).ready(function () {
        //turn to inline mode
        $.fn.editable.defaults.mode = 'popup';
        $('.role').editable();
    });
</script>
